{"version":3,"sources":["../src/star_rating.js"],"names":["define","$","Ajax","Notification","Templates","StarRating","rootSelector","contextid","root","options","data","console","log","on","e","setRating","currentTarget","done","response","stars","starrating","rating","scale","i","numberofstars","push","fullstar","halfstar","render","myrating","then","html","fail","exception","prototype","refresh","getAverageRating","averageRating","averageStars","call","methodname","args"],"mappings":"AAAAA,OAAM,6BAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,mBAAxB,CAA6C,gBAA7C,CAAD,CAAiE,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAgCC,CAAhC,CAA2C,CAE9G,GAAIC,CAAAA,CAAU,CAAG,SAASC,CAAT,CAAuBC,CAAvB,CAAkC,YAC/C,KAAKC,IAAL,CAAYP,CAAC,CAACK,CAAD,CAAb,CACA,KAAKC,SAAL,CAAiBA,CAAjB,CACA,KAAKE,OAAL,CAAe,KAAKD,IAAL,CAAUE,IAAV,CAAe,SAAf,CAAf,CACAC,OAAO,CAACC,GAAR,CAAY,KAAKH,OAAjB,EAEA,KAAKD,IAAL,CAAUK,EAAV,CAAa,OAAb,CAAsB,0BAAtB,CAAkD,SAACC,CAAD,CAAO,CACrD,CAAI,CAACC,SAAL,CAAed,CAAC,CAACa,CAAC,CAACE,aAAH,CAAD,CAAmBN,IAAnB,CAAwB,OAAxB,CAAf,EAAiDO,IAAjD,CAAsD,SAACC,CAAD,CAAc,CAGhE,OAFIC,CAAAA,CAAK,CAAG,EAEZ,CADIC,CAAU,CAAGF,CAAQ,CAACG,MAAT,CAAgBA,MAAhB,CAAyB,CAAI,CAACZ,OAAL,CAAaa,KACvD,CAASC,CAAC,CAAG,CAAb,CAAgBA,CAAC,EAAI,CAAI,CAACd,OAAL,CAAae,aAAlC,CAAiDD,CAAC,EAAlD,CAAsD,CAClDJ,CAAK,CAACM,IAAN,CAAW,CACPC,QAAQ,CAAEH,CAAC,EAAIH,CADR,CAEPO,QAAQ,CAAEJ,CAAC,CAAGH,CAAJ,EAAkBG,CAAC,CAAIH,CAAU,CAAG,CAFvC,CAGPC,MAAM,CAAEE,CAAC,CAAG,CAAI,CAACd,OAAL,CAAaa,KAHlB,CAAX,CAKH,CAEDlB,CAAS,CAACwB,MAAV,CAAiB,qBAAjB,CAAwC,CAACT,KAAK,CAAEA,CAAR,CAAeU,QAAQ,CAAE,CAAzB,CAAxC,EAAqEC,IAArE,CAA0E,SAACC,CAAD,CAAc,CACpF,CAAI,CAACvB,IAAL,CAAUuB,IAAV,CAAeA,CAAf,CACH,CAFD,EAEGC,IAFH,CAEQ7B,CAAY,CAAC8B,SAFrB,CAGH,CAdD,CAeH,CAhBD,CAiBH,CAvBD,CAyBA5B,CAAU,CAAC6B,SAAX,CAAqBC,OAArB,CAA+B,UAAW,YACtC,KAAKC,gBAAL,GAAwBnB,IAAxB,CAA6B,SAACoB,CAAD,CAAmB,CAG5C,OAFMC,CAAAA,CAAY,CAAGD,CAAa,CAAG,CAAI,CAAC5B,OAAL,CAAaa,KAElD,CADIH,CAAK,CAAG,EACZ,CAASI,CAAC,CAAG,CAAb,CAAgBA,CAAC,EAAI,CAAI,CAACd,OAAL,CAAae,aAAlC,CAAiDD,CAAC,EAAlD,CAAsD,CAClDJ,CAAK,CAACM,IAAN,CAAW,CACPC,QAAQ,CAAEH,CAAC,EAAIe,CADR,CAEPX,QAAQ,CAAEJ,CAAC,CAAGe,CAAJ,EAAoBf,CAAC,CAAIe,CAAY,CAAG,CAF3C,CAGPjB,MAAM,CAAEE,CAAC,CAAG,CAAI,CAACd,OAAL,CAAaa,KAHlB,CAAX,CAKH,CAEDX,OAAO,CAACC,GAAR,CAAYO,CAAZ,EAEAf,CAAS,CAACwB,MAAV,CAAiB,qBAAjB,CAAwC,CAACT,KAAK,CAAEA,CAAR,CAAxC,EAAwDW,IAAxD,CAA6D,SAACC,CAAD,CAAc,CACvE,CAAI,CAACvB,IAAL,CAAUuB,IAAV,CAAeA,CAAf,CACH,CAFD,EAEGC,IAFH,CAEQ7B,CAAY,CAAC8B,SAFrB,CAGH,CAhBD,EAgBGD,IAhBH,CAgBQ7B,CAAY,CAAC8B,SAhBrB,CAiBH,CAlBD,CAyBA5B,CAAU,CAAC6B,SAAX,CAAqBE,gBAArB,CAAwC,UAAW,CAC/C,MAAOlC,CAAAA,CAAI,CAACqC,IAAL,CAAU,CAAC,CACdC,UAAU,CAAE,kCADE,CAEdC,IAAI,CAAE,CAAClC,SAAS,CAAE,KAAKA,SAAjB,CAFQ,CAAD,CAAV,EAGH,CAHG,CAIV,CALD,CAaAF,CAAU,CAAC6B,SAAX,CAAqBnB,SAArB,CAAiC,SAASM,CAAT,CAAiB,CAC9C,MAAOnB,CAAAA,CAAI,CAACqC,IAAL,CAAU,CAAC,CACdC,UAAU,CAAE,0BADE,CAEdC,IAAI,CAAE,CACFlC,SAAS,CAAE,KAAKA,SADd,CAEFc,MAAM,CAAEA,CAFN,CAFQ,CAAD,CAAV,EAMH,CANG,CAOV,CARD,CAUA,MAAOhB,CAAAA,CACV,CA5EK,CAAN","sourcesContent":["define(['jquery', 'core/ajax', 'core/notification', 'core/templates'], function($, Ajax, Notification, Templates) {\n\n    let StarRating = function(rootSelector, contextid) {\n        this.root = $(rootSelector);\n        this.contextid = contextid;\n        this.options = this.root.data('options');\n        console.log(this.options);\n\n        this.root.on('click', '[data-action=set-rating]', (e) => {\n            this.setRating($(e.currentTarget).data('value')).done((response) => {\n                let stars = [];\n                let starrating = response.rating.rating * this.options.scale;\n                for (let i = 1; i <= this.options.numberofstars; i++) {\n                    stars.push({\n                        fullstar: i <= starrating,\n                        halfstar: i > starrating && i < (starrating + 1),\n                        rating: i / this.options.scale\n                    });\n                }\n\n                Templates.render('filter_rating/stars', {stars: stars, myrating: 1}).then((html, js) => {\n                    this.root.html(html);\n                }).fail(Notification.exception);\n            });\n        });\n    };\n\n    StarRating.prototype.refresh = function() {\n        this.getAverageRating().done((averageRating) => {\n            const averageStars = averageRating * this.options.scale;\n            let stars = [];\n            for (let i = 1; i <= this.options.numberofstars; i++) {\n                stars.push({\n                    fullstar: i <= averageStars,\n                    halfstar: i > averageStars && i < (averageStars + 1),\n                    rating: i / this.options.scale\n                });\n            }\n\n            console.log(stars);\n\n            Templates.render('filter_rating/stars', {stars: stars}).then((html, js) => {\n                this.root.html(html);\n            }).fail(Notification.exception);\n        }).fail(Notification.exception);\n    };\n\n    /**\n     * Get average rating for this context.\n     *\n     * @returns {Promise}\n     */\n    StarRating.prototype.getAverageRating = function() {\n        return Ajax.call([{\n            methodname: 'filter_rating_get_average_rating',\n            args: {contextid: this.contextid}\n        }])[0];\n    };\n\n    /**\n     * Get average rating for this context.\n     *\n     * @param {int} rating\n     * @returns {Promise}\n     */\n    StarRating.prototype.setRating = function(rating) {\n        return Ajax.call([{\n            methodname: 'filter_rating_set_rating',\n            args: {\n                contextid: this.contextid,\n                rating: rating\n            }\n        }])[0];\n    };\n\n    return StarRating;\n});"],"file":"star_rating.min.js"}